/**
 * Crouton Manifest Type System
 *
 * Canonical type definitions for package manifests.
 * Every crouton package declares a `crouton.manifest.ts` using these types.
 *
 * @crouton-generated â€” do not edit manually
 */

export interface CroutonManifest {
  // Identity
  id: string
  name: string
  description: string
  icon: string
  version: string

  // Classification
  category: 'core' | 'addon' | 'miniapp'
  bundled?: boolean

  // Layer
  layer?: {
    name: string
    editable: boolean
    reason?: string
  }

  // Dependencies
  dependencies?: string[]

  // Field type contributions
  fieldTypes?: Record<string, FieldTypeDefinition>

  // Auto-generated fields (only crouton-core declares this)
  autoGeneratedFields?: string[]
  reservedFieldNames?: string[]
  reservedCollectionNames?: string[]

  // Collections this package provides
  collections?: ManifestCollection[]

  // Configuration options
  configuration?: Record<string, ManifestConfigOption>

  // Extension points
  extensionPoints?: ManifestExtensionPoint[]

  // What the package provides
  provides?: {
    composables?: string[]
    components?: ManifestComponent[]
    apiRoutes?: string[]
  }

  // AI hints (migrated from module-registry.json)
  aiHint?: string
}

export interface FieldTypeDefinition {
  label: string
  icon: string
  description: string
  db: string
  drizzle: string
  zod: string
  tsType: string
  defaultValue: string
  component?: string
  previewComponent?: string
  aliases?: string[]
  meta?: Record<string, unknown>
}

export interface ManifestCollection {
  name: string
  tableName?: string
  description: string
  schema?: Record<string, ManifestSchemaField>
  schemaPath?: string
  optional?: boolean
  condition?: string
  hierarchy?: boolean | { parentField: string; orderField: string }
}

export interface ManifestSchemaField {
  type: string
  meta?: Record<string, unknown>
  refTarget?: string
  refScope?: string
}

export interface ManifestConfigOption {
  type: 'boolean' | 'string' | 'number' | 'select' | 'multiselect'
  label: string
  description?: string
  default: unknown
  options?: Array<{ value: string; label: string }>
}

export interface ManifestExtensionPoint {
  collection: string
  allowedFields: string[]
  description: string
}

export interface ManifestComponent {
  name: string
  description: string
  props?: string[]
}

export function defineCroutonManifest(manifest: CroutonManifest): CroutonManifest {
  if (!manifest.id || !manifest.name) {
    throw new Error(`Manifest must have id and name`)
  }
  return manifest
}
