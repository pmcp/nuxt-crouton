<!--
  @crouton-generated
  @collection pages
  @layer pages
  @generated 2026-01-16

  ## AI Context
  - Card component for pages collection tree view
  - Used by CroutonTreeNode when layout='tree'
  - Shows: page type icon, title, slug, visibility, status, timestamp

  ## Common Modifications
  - Change display fields: Update template
  - Add actions: Use click handlers
  - Change styling: Update classes

  Generated by @friendlyinternet/nuxt-crouton-cli
  Safe to modify - regeneration requires --force flag
-->

<script setup lang="ts">
import { useTimeAgo } from '@vueuse/core'
import type { PagesPage } from '../../types'

interface Props {
  item: PagesPage & { children?: any[] }
  layout: 'list' | 'grid' | 'cards' | 'tree'
  collection: string
}

const props = defineProps<Props>()

const { getPageType } = usePageTypes()
const { locale } = useI18n()

// Get page type info for icon
const pageType = computed(() => getPageType(props.item.pageType))

// Get localized title with fallbacks
const localizedTitle = computed(() => {
  const translations = props.item.translations as Record<string, { title?: string }> | undefined
  return translations?.[locale.value]?.title
    || translations?.en?.title
    || props.item.title
    || 'Untitled'
})

// Relative time ago
const timeAgo = useTimeAgo(() => props.item.updatedAt || props.item.createdAt)

// Status color mapping
const statusColor = computed(() => {
  switch (props.item.status) {
    case 'published': return 'success' as const
    case 'draft': return 'warning' as const
    case 'archived': return 'neutral' as const
    default: return 'neutral' as const
  }
})

// Visibility color mapping
const visibilityColor = computed(() => {
  switch (props.item.visibility) {
    case 'public': return 'info' as const
    case 'members': return 'warning' as const
    case 'hidden': return 'neutral' as const
    default: return 'info' as const
  }
})
</script>

<template>
  <div class="flex items-center gap-2 flex-1 min-w-0">
    <!-- Page type icon -->
    <UIcon
      :name="pageType?.icon || 'i-lucide-file-text'"
      class="size-4 shrink-0 text-muted"
    />

    <!-- Title and slug -->
    <div class="flex-1 min-w-0">
      <span class="text-sm font-medium truncate block">
        {{ localizedTitle }}
      </span>
      <span class="text-xs text-muted truncate block">
        /{{ props.item.slug || '' }}
      </span>
    </div>

    <!-- Right side: visibility, status, timestamp - fixed width for alignment -->
    <div class="flex items-center gap-2 shrink-0">
      <!-- Visibility badge -->
      <UBadge
        :color="visibilityColor"
        size="xs"
        variant="subtle"
        class="w-16 justify-center"
      >
        {{ props.item.visibility || 'public' }}
      </UBadge>

      <!-- Status badge -->
      <UBadge
        :color="statusColor"
        size="xs"
        variant="subtle"
        class="w-20 justify-center"
      >
        {{ props.item.status }}
      </UBadge>

      <!-- Relative timestamp - fixed width for alignment -->
      <span class="text-xs text-muted tabular-nums w-24 text-right">
        {{ timeAgo }}
      </span>
    </div>
  </div>
</template>
