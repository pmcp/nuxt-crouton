---
title: Sales (POS)
description: Event-based Point of Sale system for markets and pop-up events
icon: i-lucide-shopping-cart
---

# Sales (POS)

::callout{type="warning"}
**Experimental**: This feature is under active development. API may change.
::

The Sales feature provides an event-based Point of Sale (POS) system designed for pop-up events, markets, and temporary retail situations.

## Enable

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: ['@fyit/crouton'],

  crouton: {
    sales: true
  }
})
```

## Key Features

- **Event-based**: Products organized by events
- **Categories**: Product categorization with tabs
- **Cart system**: Shopping cart with quantity controls
- **Helper authentication**: PIN-based volunteer/staff access
- **Offline support**: Works without internet connection
- **Thermal printing**: Optional receipt printing (opt-in)

## Architecture

```
Event → Products/Categories → Customer selects → Cart → Order → Print (opt-in)
```

1. Admin creates Event with Products organized by Categories
2. Customer (or Helper) opens order interface for event
3. Products displayed by category, options available
4. Items added to cart with quantities and remarks
5. Checkout creates Order with OrderItems
6. If printing enabled: Print jobs queued for locations

## Composables

### usePosOrder

Cart management and checkout:

```typescript
const {
  cart,
  addItem,
  removeItem,
  updateQuantity,
  clearCart,
  total,
  itemCount,
  checkout,
  loading
} = usePosOrder()

// Add product to cart
addItem({
  productId: 'prod-123',
  quantity: 2,
  options: { size: 'large' },
  remarks: 'Extra cheese'
})

// Checkout
const order = await checkout({
  eventId: 'event-456',
  clientId: 'client-789'  // Optional
})
```

### useHelperAuth

Helper authentication (PIN-based):

```typescript
const {
  isHelper,
  helperName,
  eventId,
  teamId,
  login,
  logout
} = useHelperAuth()

// Login with PIN
await login({
  teamId: 'team-123',
  eventId: 'event-456',
  pin: '1234',
  helperName: 'John'  // For new helpers
})

// Check authentication
if (isHelper.value) {
  console.log(`Welcome, ${helperName.value}!`)
}

// Logout
await logout()
```

## Components

### Customer-Facing

| Component | Purpose |
|-----------|---------|
| `SalesClientOrderInterface` | Main order page |
| `SalesClientProductList` | Product grid with options |
| `SalesClientCategoryTabs` | Category navigation |
| `SalesClientCart` | Shopping cart display |
| `SalesClientCartTotal` | Order total display |
| `SalesClientSelector` | Client selector with create-on-type |
| `SalesClientOfflineBanner` | Offline mode indicator |

### Orders

| Component | Purpose |
|-----------|---------|
| `SalesPosOrdersList` | Orders table with filtering |

### Admin

| Component | Purpose |
|-----------|---------|
| `SalesAdminPosSidebar` | Admin navigation sidebar |

### Print Settings (Opt-in)

| Component | Purpose |
|-----------|---------|
| `SalesSettingsReceiptSettingsModal` | Receipt customization |
| `SalesSettingsPrintPreviewModal` | Receipt preview |

## Database Tables

The package expects tables with `sales` prefix:

| Table | Purpose |
|-------|---------|
| `salesEvents` | Event definitions |
| `salesProducts` | Products for sale |
| `salesCategories` | Product categories |
| `salesOrders` | Completed orders |
| `salesOrderitems` | Order line items |
| `salesLocations` | Event locations |
| `salesClients` | Customer records |
| `salesEventsettings` | Event-specific settings |
| `salesPrinters` | Printer configs (opt-in) |
| `salesPrintqueues` | Print jobs (opt-in) |

## Helper Authentication

Helpers (volunteers, staff) authenticate with an event's shared PIN.

### Event PIN Setup

Events must have a `helperPin` field:

```json
// schemas/events.json
{
  "helperPin": {
    "type": "string",
    "meta": { "label": "Helper PIN", "maxLength": 6 }
  }
}
```

### Server-side Validation

```typescript
// In API handlers
import { requireScopedAccess } from '@fyit/crouton-auth/server'

export default defineEventHandler(async (event) => {
  const access = await requireScopedAccess(event, 'pos-helper-token')

  // access.displayName - Helper's name
  // access.resourceId - Event ID
  // access.organizationId - Team ID
  // access.role - 'helper'
})
```

## Configuration

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: ['@fyit/crouton'],

  crouton: {
    sales: true
  },

  // Optional: Enable printing
  croutonSales: {
    print: { enabled: true }
  }
})
```

## Workflow

1. Install package and copy schemas
2. Configure `crouton.config.js` with `sales` layer
3. Run `crouton config` to generate collections
4. Add package to nuxt.config
5. Run migrations
6. POS system ready

## Offline Support

The order interface includes offline mode:
- `SalesClientOfflineBanner` shows when offline
- Orders queue locally and sync when back online
- Products and categories cache for offline use

## Thermal Printing

Optional receipt printing support:

1. Enable in config: `croutonSales.print.enabled: true`
2. Add printer/printQueue schemas
3. Configure printers in admin
4. Receipts print automatically on order completion

## Use Cases

- **Markets**: Farmers markets, craft fairs
- **Pop-up shops**: Temporary retail locations
- **Events**: Festivals, conferences, concerts
- **Food service**: Food trucks, event catering
- **Fundraisers**: Charity sales, school events

## Testing

A test app is available at `apps/test-sales/`:

```bash
cd apps/test-sales
pnpm crouton generate
npx nuxt db:generate
npx nuxt db:migrate
pnpm dev
```

## Related

- [Bookings](/features/bookings) - Related booking system
- [Authentication](/advanced/team-based-auth) - User authentication
- [Package Architecture](/fundamentals/packages#fyi-crouton-sales) - Package details
