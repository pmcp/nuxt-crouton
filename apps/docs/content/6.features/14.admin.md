---
title: Admin Dashboard
description: Super admin dashboard for user management, team oversight, and moderation
icon: i-heroicons-shield-check
---

The `@friendlyinternet/crouton-admin` package provides a complete admin dashboard for managing users, teams, and platform moderation. It extends `@friendlyinternet/crouton-auth` and provides pre-built pages, components, and composables for admin functionality.

## Installation

```bash
# Install both auth and admin packages
pnpm add @friendlyinternet/crouton-auth
pnpm add @friendlyinternet/crouton-admin
```

```typescript [nuxt.config.ts]
export default defineNuxtConfig({
  modules: ['@friendlyinternet/crouton-auth'],

  extends: [
    '@friendlyinternet/crouton-admin'
  ],

  croutonAuth: {
    mode: 'multi-tenant'
  }
})
```

## Features

### Dashboard Stats

View key metrics at a glance:
- Total users and new signups
- Banned users count
- Total teams/organizations
- Active sessions
- Super admin count

### User Management

Full user lifecycle management:
- **List users** with search and filters (status, super admin)
- **Create users** with password and role assignment
- **Ban users** with reason and optional duration
- **Unban users** to restore access
- **Delete users** permanently

### Team Oversight

View and monitor all teams:
- List all teams with member counts
- View team details and members
- Monitor team activity

### User Impersonation

Debug issues by becoming any user:
- Start impersonation session
- Visual banner showing impersonation status
- Stop impersonation to return to admin account

## Pages

The package provides ready-to-use admin pages:

| Page | Path | Purpose |
|------|------|---------|
| Dashboard | `/admin` | Stats overview and quick actions |
| Users | `/admin/users` | User management |
| Teams | `/admin/teams` | Team oversight |

All pages are protected by the `super-admin` middleware.

## Middleware

### super-admin

Protects routes to require super admin privileges. Redirects non-admins to the home page.

```vue [pages/admin/custom.vue]
<script setup lang="ts">
definePageMeta({
  middleware: 'super-admin'
})
</script>

<template>
  <div>Custom admin page content</div>
</template>
```

## Composables

### useAdminUsers()

User management operations.

```typescript
const {
  users,           // List of users
  total,           // Total count
  page,            // Current page
  loading,         // Loading state
  error,           // Error message

  getUsers,        // Fetch users with filters
  getUser,         // Get user detail
  createUser,      // Create new user
  banUser,         // Ban a user
  unbanUser,       // Unban a user
  deleteUser       // Delete user permanently
} = useAdminUsers()

// Fetch users with filters
await getUsers({
  page: 1,
  pageSize: 20,
  search: 'john',
  status: 'active',     // 'all' | 'active' | 'banned'
  superAdmin: false,
  sortBy: 'createdAt',
  sortOrder: 'desc'
})

// Ban a user
await banUser('user-id', {
  reason: 'Spam activity',
  duration: 168  // hours (null = permanent)
})
```

### useAdminTeams()

Team management operations.

```typescript
const {
  teams,           // List of teams
  total,           // Total count
  loading,         // Loading state
  error,           // Error message

  getTeams,        // Fetch teams with filters
  getTeam          // Get team detail with members
} = useAdminTeams()

// Fetch teams
await getTeams({
  page: 1,
  pageSize: 20,
  search: 'acme',
  personal: false,
  sortBy: 'memberCount',
  sortOrder: 'desc'
})
```

### useAdminStats()

Dashboard statistics with optional auto-refresh.

```typescript
const {
  stats,           // AdminStats object
  loading,         // Loading state
  error,           // Error message
  lastUpdated,     // Last fetch timestamp

  getStats,        // Fetch stats
  startAutoRefresh,// Start auto-refresh
  stopAutoRefresh  // Stop auto-refresh
} = useAdminStats({ autoRefresh: true, refreshInterval: 30000 })

// Stats include:
// - totalUsers, newUsersToday, newUsersWeek
// - bannedUsers, superAdminCount
// - totalTeams, newTeamsWeek
// - activeSessions
```

### useImpersonation()

User impersonation for debugging.

```typescript
const {
  isImpersonating,     // Boolean: currently impersonating
  impersonatedUser,    // User being impersonated
  originalAdminId,     // Original admin's ID
  loading,             // Loading state

  startImpersonation,  // Start impersonating a user
  stopImpersonation,   // Return to admin account
  checkStatus          // Check current status
} = useImpersonation()

// Start impersonating
await startImpersonation('user-id')

// Stop impersonating
await stopImpersonation()
```

## Components

### Dashboard Components

| Component | Purpose |
|-----------|---------|
| `AdminDashboard` | Full dashboard with stats and quick actions |
| `AdminStatsCard` | Individual stat card with icon and trend |

```vue
<template>
  <AdminDashboard
    :stats="preloadedStats"
    :show-quick-actions="true"
    @navigate="handleNavigation"
  />
</template>
```

### User Components

| Component | Purpose |
|-----------|---------|
| `AdminUserList` | Paginated user table with search and filters |
| `AdminUserActions` | Dropdown menu for user actions |
| `AdminUserBanForm` | Form for banning with reason and duration |
| `AdminUserCreateForm` | Form for creating new users |

```vue
<template>
  <AdminUserList
    :page-size="20"
    @user-selected="handleSelect"
  />
</template>
```

### Team Components

| Component | Purpose |
|-----------|---------|
| `AdminTeamList` | Paginated team table with search |

### Global Components

| Component | Purpose |
|-----------|---------|
| `ImpersonationBanner` | Top banner when impersonating a user |

Add to your app layout to show impersonation status:

```vue [layouts/default.vue]
<template>
  <div>
    <ImpersonationBanner />
    <slot />
  </div>
</template>
```

## API Endpoints

### Users

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/admin/users` | List users with pagination |
| GET | `/api/admin/users/[id]` | Get user detail |
| POST | `/api/admin/users/create` | Create new user |
| POST | `/api/admin/users/ban` | Ban a user |
| POST | `/api/admin/users/unban` | Unban a user |
| DELETE | `/api/admin/users/delete` | Delete a user |

### Teams

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/admin/teams` | List teams |
| GET | `/api/admin/teams/[id]` | Get team with members |

### Stats

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/admin/stats` | Get dashboard statistics |

### Impersonation

| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/api/admin/impersonate/start` | Start impersonation |
| POST | `/api/admin/impersonate/stop` | Stop impersonation |
| GET | `/api/admin/impersonate/status` | Check impersonation status |

## Server Utilities

### requireSuperAdmin(event)

Server-side authorization check. Use in custom admin endpoints.

```typescript [server/api/admin/custom.ts]
import { requireSuperAdmin } from '#crouton/admin'

export default defineEventHandler(async (event) => {
  // Throws 403 if not super admin
  const { user: adminUser } = await requireSuperAdmin(event)

  // Your admin logic here
  return { admin: adminUser.name }
})
```

## Making a User Super Admin

Super admin privileges are stored in the `superAdmin` field on the user table.

### Via Database Migration

```typescript [scripts/make-admin.ts]
import { db } from '@crouton/auth'
import { user } from '@crouton/auth/server/database/schema/auth'
import { eq } from 'drizzle-orm'

await db.update(user)
  .set({ superAdmin: true })
  .where(eq(user.email, 'admin@example.com'))
```

### Via Seed Script

```typescript [scripts/seed.ts]
import { db } from '@crouton/auth'
import { user } from '@crouton/auth/server/database/schema/auth'

await db.insert(user).values({
  id: 'admin-id',
  email: 'admin@example.com',
  name: 'Admin User',
  emailVerified: true,
  superAdmin: true
})
```

## Configuration

```typescript [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    public: {
      crouton: {
        admin: {
          // Admin route prefix (default: /admin)
          routePrefix: '/admin',

          // Enable impersonation feature
          impersonation: true,

          // Stats auto-refresh interval (ms)
          statsRefreshInterval: 30000
        }
      }
    }
  }
})
```

## Ban Durations

Pre-defined ban duration options:

| Duration | Hours |
|----------|-------|
| 1 hour | 1 |
| 24 hours | 24 |
| 7 days | 168 |
| 30 days | 720 |
| 90 days | 2160 |
| Permanent | null |

## Customization

### Override Pages

Create your own page at the same path to override:

```vue [pages/admin/index.vue]
<script setup lang="ts">
definePageMeta({ middleware: 'super-admin' })
</script>

<template>
  <div>
    <h1>My Custom Admin Dashboard</h1>
    <!-- Your custom content -->
  </div>
</template>
```

### Override Impersonation Banner

Create your own `ImpersonationBanner.vue`:

```vue [components/ImpersonationBanner.vue]
<script setup lang="ts">
const { isImpersonating, impersonatedUser, stopImpersonation } = useImpersonation()
</script>

<template>
  <div v-if="isImpersonating" class="my-custom-banner">
    Impersonating: {{ impersonatedUser?.name }}
    <button @click="stopImpersonation">Stop</button>
  </div>
</template>
```

## Types

### AdminStats

```typescript
interface AdminStats {
  totalUsers: number
  newUsersToday: number
  newUsersWeek: number
  bannedUsers: number
  totalTeams: number
  newTeamsWeek: number
  activeSessions: number
  superAdminCount: number
}
```

### BanPayload

```typescript
interface BanPayload {
  userId: string
  reason: string
  duration: number | null  // hours, null = permanent
}
```

### ImpersonationState

```typescript
interface ImpersonationState {
  isImpersonating: boolean
  originalAdminId: string | null
  impersonatedUser: {
    id: string
    name: string
    email: string
  } | null
}
```

## Security Considerations

1. **Super admin access is required** for all admin endpoints
2. **Cannot ban other super admins** - protects against admin lockout
3. **Cannot ban yourself** - prevents self-lockout
4. **Impersonation is logged** - original admin ID stored in session
5. **Sessions are invalidated** when a user is banned

## Related

- [Team-Based Auth](/advanced/team-based-auth) - Authentication with teams
- [Package Architecture](/fundamentals/packages) - Understanding the ecosystem
