# Brief: Create test-sales App

**Created**: 2024-12-22
**Status**: Complete
**Completed**: 2024-12-25
**Priority**: Medium

---

## Goal

Create a minimal test app at `apps/test-sales/` to verify the `@friendlyinternet/crouton-sales` package works end-to-end.

---

## Quick Stats

| Metric | Value |
|--------|-------|
| Tasks | 8 / 8 completed |
| Estimated Time | 1-2 hours |
| Actual Time | ~15 minutes |

---

## Task Tracker

### Phase 1: App Setup

- [x] **1.1** Create app skeleton
  - Create `apps/test-sales/` directory
  - Initialize with minimal nuxt.config.ts
  - Add to workspace in root package.json

- [x] **1.2** Configure dependencies
  - Add workspace dependencies:
    - `@friendlyinternet/nuxt-crouton`: `workspace:*`
    - `@friendlyinternet/nuxt-crouton-auth`: `workspace:*`
    - `@friendlyinternet/crouton-sales`: `workspace:*`
  - Add required deps: `@nuxt/ui`, `@nuxthub/core`, `zod`

### Phase 2: Collection Generation

- [x] **2.1** Copy schemas
  - Copy from `packages/crouton-sales/schemas/*.json` to `apps/test-sales/schemas/`

- [x] **2.2** Create crouton.config.js (used .js instead of .mjs)
  ```javascript
  export default {
    dialect: 'sqlite',
    collections: [
      { name: 'events', fieldsFile: './schemas/events.json' },
      { name: 'products', fieldsFile: './schemas/products.json' },
      { name: 'categories', fieldsFile: './schemas/categories.json' },
      { name: 'orders', fieldsFile: './schemas/orders.json' },
      { name: 'orderItems', fieldsFile: './schemas/orderItems.json' },
      { name: 'locations', fieldsFile: './schemas/locations.json' },
      { name: 'clients', fieldsFile: './schemas/clients.json' },
      { name: 'eventSettings', fieldsFile: './schemas/eventSettings.json' }
    ],
    targets: [
      {
        layer: 'sales',
        collections: [
          'events', 'products', 'categories', 'orders',
          'orderItems', 'locations', 'clients', 'eventSettings'
        ]
      }
    ],
    flags: {
      useTeamUtility: true,
      useMetadata: true,
      noTranslations: true
    }
  }
  ```

- [x] **2.3** Generate collections (10 collections including printers/printQueues)
  - Run `crouton config` in apps/test-sales/
  - Verify `layers/sales/` is created

### Phase 3: Nuxt Configuration

- [x] **3.1** Configure nuxt.config.ts
  ```typescript
  export default defineNuxtConfig({
    extends: [
      '@friendlyinternet/nuxt-crouton',
      '@friendlyinternet/nuxt-crouton-auth',
      '@friendlyinternet/crouton-sales',
      './layers/sales'
    ],
    modules: [
      '@nuxthub/core',
      '@nuxt/ui'
    ],
    hub: { db: 'sqlite' },  // IMPORTANT: Use 'db: sqlite', NOT 'database: true'
    compatibilityDate: '2025-07-15'
  })
  ```

- [x] **3.2** Run migrations
  - Generate: `npx drizzle-kit generate`
  - Migrate: `npx drizzle-kit migrate`

### Phase 4: Verification

- [x] **4.1** Create test pages
  - `app/pages/index.vue` - Dashboard with links
  - `app/pages/products.vue` - Test `<SalesProductsList />`
  - `app/pages/order.vue` - Test `<SalesClientOrderInterface />`

- [x] **4.2** Verify functionality
  - [x] Dev server starts successfully
  - [x] Components auto-import with `Sales` prefix
  - [ ] `usePosOrder()` composable (needs runtime testing)
  - [x] Collection composables work (config objects)
  - [x] Generated API endpoints present
  - [x] `npx nuxt typecheck` ran (pre-existing errors in package/generator)

---

## File Structure

```
apps/test-sales/
├── app/
│   └── pages/
│       ├── index.vue
│       └── order.vue
├── layers/
│   └── sales/              # Generated by crouton
├── schemas/                   # 10 schemas copied from crouton-sales
│   ├── events.json
│   ├── products.json
│   ├── categories.json
│   ├── orders.json
│   ├── orderItems.json
│   ├── locations.json
│   ├── clients.json
│   ├── eventSettings.json
│   ├── printers.json
│   └── printQueues.json
├── server/
│   └── database/
│       └── migrations/
├── assets/css/main.css
├── crouton.config.js
├── nuxt.config.ts
├── package.json
└── tsconfig.json
```

---

## package.json Template

```json
{
  "name": "test-sales",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "nuxt dev",
    "build": "nuxt build",
    "typecheck": "npx nuxt typecheck"
  },
  "dependencies": {
    "@friendlyinternet/nuxt-crouton": "workspace:*",
    "@friendlyinternet/nuxt-crouton-auth": "workspace:*",
    "@friendlyinternet/crouton-sales": "workspace:*",
    "@nuxt/ui": "^4.0.0",
    "@nuxthub/core": "^0.8.0",
    "nuxt": "^4.0.0",
    "zod": "^3.0.0"
  },
  "devDependencies": {
    "drizzle-kit": "^0.31.0"
  }
}
```

---

## Success Criteria

- [x] App starts with `pnpm dev`
- [ ] No TypeScript errors (pre-existing errors in crouton-sales package)
- [ ] Components render correctly (needs browser testing)
- [ ] CRUD operations work (needs browser testing)
- [ ] `usePosOrder()` cart functionality works (needs browser testing)
- [x] Collection composables are auto-imported

---

## Notes

- This is a minimal test app, not a full demo
- No authentication required for initial testing (skip helper auth)
- Use SQLite for simplicity
- Can extend to test print module later (add printers/printQueues schemas)

---

## Related

- Package: `packages/crouton-sales/`
- Package brief: `docs/upcoming/crouton-sales-package-brief.md`
- Similar test app: `apps/test-nuxthub/`
